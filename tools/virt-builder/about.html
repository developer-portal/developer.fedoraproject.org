<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Virt-builder &mdash; Fedora Developer Portal</title>
  <meta name="description" content="Fedora Developer Portal provides information for developers running Fedora on their workstation or virtual machines.
">
  <link rel="canonical" href="https://developer.fedoraproject.org/tools/virt-builder/about.html">
  <!-- Link to Sitemap -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
  <link href="/css/main.css" rel="stylesheet" media="screen, print">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-69605821-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>
  <body>
        <!-- The top blue thing -->
    <div id="splash" class="splash-size-small splash-section-tools">
      <div class="container">
        <div class="row" id="top">
  <div class="col-sm-2" id="logo-col">
    <div class="text-center">
      <h1>
        <a href="/">
          <img src="/static/logo_white.png" style="height: 46px; width: 152px;">
          <span>Fedora Developer Portal</span>
        </a>
      </h1>
    </div>
  </div>
  <div class="col-sm-7" id="menu-col">
    <nav>
  <ul class="nav navbar-nav">
    <li class="">
      <a href="/start.html">Start a project</a>
    </li>
    <li class=" active ">
      <a href="/tools.html">Get tools</a>
    </li>
    <li class="">
      <a href="/tech.html">Languages &amp; databases</a>
    </li>
    <li class="">
      <a href="/deployment.html">Deploy and distribute</a>
    </li>
    <!--
    <li class="">
      <a href="/">Resources</a>
    </li>
    <li class="">
      <a href="/">Blogs</a>
    </li>
    -->
  </ul>
</nav>
  </div>
  <div class="col-sm-3" id="search-col" style="display: none;">
<!-- // every other page -->
<style media="screen, print">
#search-results {
  position: absolute;
  top: 44px;
  right: 15px;
  z-index: 10;
  width: 288px;
  max-height: 260px;
  overflow-y: scroll;
  padding: 0 10px 0 10px;
  background-color: #fff;
  border: 1px solid transparent;
  border-radius: 4px;
  box-shadow: 0 1px 1px rgba(0,0,0,.05);
}
#search-results a {
  color: #000;
  text-decoration: none;
}
#search-results a:visited {
  color: #000;
}
#search-results article, a {
  width: 100%;
}
#search-results a {
  display: block;
}
#search-results article:hover {
  background-color: #e6e6e6;
}
</style>
  <form class="input-group" id="search" action="/search.html" method="get">
    <input type="text" id="search-query" class="form-control" name="q" placeholder="Search" autocomplete="off">
    <span class="input-group-btn">
      <button class="btn btn-default glyphicon glyphicon-search" type="submit" aria-hidden="true"></button>
    </span>
  </form>
  <section id="search-results" style="display: none;">
    <div class="entries">
    </div>
  </section>
  <script id="search-results-template" type="text/mustache">
    {{#entries}}
      <article>
        <a href="{{url}}">{{title}}</a>
      </article>
    {{/entries}}
  </script>
  </div>
</div>
        <div class="row" id="headlines">
  <div class="col-sm-12">
          <img class="img-rounded" src="/static/logo/virt-builder.png">
          <h2>Virt-builder</h2>
          <p>Tool to quickly build (and customize) virtual machine images</p>
  </div>
</div>
<div class="row" id="attribution">
  <div class="col-sm-12">
    <a href=""></a>
  </div>
</div>
      </div>
    </div>
    <!-- Content -->
    <div class="container">
      <div class="row">
        <div class="col-sm-3">
          <div class="list-group content-menu">
                <a href="/tools/virt-builder/about.html" class="list-group-item  active ">Virt-builder</a>
          </div>
          <div class="panel panel-default">
            <div class="panel-body" style="padding-top:8px;padding-bottom:8px">
              <div id="ask-fedora">
  Have a question?
    <a href="//ask.fedoraproject.org/">Ask Fedora.</a>
</div>
            </div>
          </div>
          <a href="https://github.com/developer-portal/content/edit/master/tools/virt-builder/about.md" class="btn btn-default">Edit this page</a>
          <a href="https://github.com/developer-portal/content/issues/new?title=tools:+virt-builder+about.md&body=Describe+the+problem" class="btn btn-default">Report an issue</a>
        </div>
        <div class="col-sm-9">
          <div class="panel panel-default content-content">
            <h1 id="virt-builder">Virt-builder</h1>
<p><a href="http://libguestfs.org/virt-builder.1.html">Virt-builder</a> is a tool for
quickly building new virtual machines.  You can build a variety of
VMs for local or cloud use, usually within a few minutes or less.
Virt-builder also has many ways to customize these VMs.  Everything is
run from the command line and nothing requires root privileges, so
automation and scripting is simple.</p>
<p>Note that <code class="language-plaintext highlighter-rouge">virt-builder</code> does not install guests from scratch.  It takes
cleanly prepared, digitally signed OS templates and customizes them.
This approach is used because it is much faster, but if you need to do
fresh installs you may want to look at
<a href="https://github.com/virt-manager/virt-manager/blob/master/man/virt-install.pod"><code class="language-plaintext highlighter-rouge">virt-install(1)</code></a>
and
<a href="https://github.com/clalancette/oz/wiki/oz-install"><code class="language-plaintext highlighter-rouge">oz-install(1)</code></a>.</p>
<p>Refer to the <a href="http://libguestfs.org/virt-builder.1.html">extensive
documentation of <code class="language-plaintext highlighter-rouge">virt-builder</code></a>.</p>
<h2 id="installation">Installation</h2>
<p>Virt-builder tool is provided as part of <code class="language-plaintext highlighter-rouge">libguestfs-tools-c</code> RPM
package in Fedora:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo dnf install libguestfs-tools-c
</code></pre></div></div>
<h2 id="simple-usage">Simple usage</h2>
<p>Build a minimal VM disk image:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virt-builder fedora-27 --root-password password:123456
</code></pre></div></div>
<p>will build a Fedora 27 image (called ‘fedora-27.img’, in the current
working directory, which will later be imported into libvirt for use)
for the same architecture as virt-builder (so running it from an i386
installation will try to build an i386 image, if available).  This will
have all default configuration (minimal size, no user accounts, random
root password, only the bare minimum installed software, etc.).</p>
<p>Import the above disk image into libvirt:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virt-install \
   --name f27vm1 --ram 2048 \
   --disk path=fedora-27.img,format=raw \
   --os-variant fedora27 \
   --import
</code></pre></div></div>
<p>Note: The <code class="language-plaintext highlighter-rouge">--os-variant</code> doesn’t <em>strictly</em> have to be F27; the nearest
possible available Fedora variant is fine.  To find the list of variants
for your current Fedora release, run: <code class="language-plaintext highlighter-rouge">osinfo-query os | grep fedora</code>.</p>
<h2 id="examples-to-create-custom-virtual-machines">Examples to create custom virtual machines</h2>
<h3 id="create-an-up-to-date-fedora-27-vm">Create an up-to-date Fedora 27 VM</h3>
<p>Prepare a QCOW2 Fedora 27 VM, with 40GB disk size, and update to latest
available packages:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virt-builder fedora-27 -o f27vm2.qcow2 --format qcow2 \
    --update --selinux-relabel --size 40G
</code></pre></div></div>
<p>Import the disk image into libvirt, and provide it 4GB of memory:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virt-install --name f27vm2 --ram 4096 \
    --disk path=f27vm2.qcow2,format=qcow2,cache=writeback \
    --nographics --os-variant fedora27 --import
</code></pre></div></div>
<h3 id="create-a-rawhide-vm-disk-image">Create a rawhide VM disk image</h3>
<p>This creates a rawhide disk image:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ virt-builder fedora-27 \
    --install fedora-repos-rawhide \
    --edit '/etc/yum.repos.d/fedora-rawhide.repo: s/enabled=0/enabled=1/' \
    --update \
    --selinux-relabel --size 40G \
    --output rawhide-vm.img
</code></pre></div></div>
<p>Import it into libvirt with <code class="language-plaintext highlighter-rouge">virt-install</code> (as shown in previous
examples).</p>
<p>NOTE: The ‘fedora-repos-rawhide’ RPM can also be installed from
inside the image too:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo dnf install fedora-repos-rawhide
</code></pre></div></div>
<h2 id="manipulating-the-virtual-machines">Manipulating the virtual machines</h2>
<p>Use the libvirt shell interface <code class="language-plaintext highlighter-rouge">virsh(1)</code> or <code class="language-plaintext highlighter-rouge">virt-manager(1)</code> to
manipulate the VM.  A couple of examples:</p>
<p>Enumerate all virtual machines:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo virsh list --all
</code></pre></div></div>
<p>Start a VM:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo virsh start f27vm1
</code></pre></div></div>
<p>Take a snapshot of a running virtual machine:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo virsh snapshot-create-as f27vm1 snap1 "Clean F27 VM"
</code></pre></div></div>
<p>NOTE: With this kind of snapshot, the original and its delta (the
snapshot) are stored in a single disk image file (convenient for moving
them across machines).  The VM disk image should be of QCOW2 format.</p>
<p>Revert to a specific snapshot:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo virsh snapshot-revert f27vm1 snap1
</code></pre></div></div>
<p>Cleaning up VMs and their associated storage:</p>
<p>To gracefully shutdown and delete a virtual machine (including all its
associated disk images):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo virsh stop f27vm1
$ sudo virsh undefine f27vm1 --remove-all-storage
</code></pre></div></div>
<p>NOTE: The flag <code class="language-plaintext highlighter-rouge">--remove-all-storage</code> will delete the VM’s disk image(s),
so ensure you took out relevant data from your VMs.</p>
<hr id="authors-rule" />
<p style="text-align: center">Authors: <a href="mailto:%61%73%61%6D%61%6C%69%6B@%72%65%64%68%61%74.%63%6F%6D">Adam Samalik</a>, <a href="mailto:%74%68%61%75%6D%6F%73@%77%6F%6F%64%6C%61%6E%64.%69%6F">Dylan Silva</a>, <a href="mailto:%6A%73%74%72%69%62%6E%79@%72%65%64%68%61%74.%63%6F%6D">Josef Stribny</a>, <a href="mailto:%6B%63%68%61%6D%61%72%74@%72%65%64%68%61%74.%63%6F%6D">Kashyap Chamarthy</a>, <a href="mailto:%70%68%72%61%63%65%6B@%72%65%64%68%61%74.%63%6F%6D">Petr Hracek</a></p>
          </div>
        </div>
      </div>
    </div>
    <!-- Some other stuff -->
    <div class=" banner-contribute">
  <div class="container">
    <h2> Share your knowledge </h2>
    <p> Fedora Developer Portal is a community effort to share guides and information about open-source development. And we need your help! </p>
    <a href="http://developer-portal.github.io/contributing/" class="btn btn-primary">Learn how to contribute</a>
  </div>
</div>
    <footer class="footer">
  <div class="container">
    <div class="row footerlinks">
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">About</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="/about.html">About Developer Portal</a></dd>
            <dd><a href="https://docs.fedoraproject.org/en-US/project/">About Fedora</a></dd>
            <dd><a href="https://getfedora.org/en/sponsors">Sponsors</a></dd>
            <dd><a href="https://fedoramagazine.org">Fedora Magazine</a></dd>
            <dd><a href="https://fedoraproject.org/wiki/Legal:Main#Legal">Legal</a></dd>
          </dl>
          <ul class="list-inline">
            <li>
              <a class="btn-social btn-outline" href="https://www.facebook.com/TheFedoraProject"><i class="fa fa-fw fa-facebook"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="https://plus.google.com/112917221531140868607"><i class="fa fa-fw fa-google-plus"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="https://twitter.com/fedora"><i class="fa fa-fw fa-twitter"></i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title uppercase">Download</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="https://getfedora.org/en/workstation/download/">Get Fedora Workstation</a></dd>
            <dd><a href="https://getfedora.org/en/server/download/">Get Fedora Server</a></dd>
            <dd><a href="https://getfedora.org/en/atomic/download/">Get Fedora Atomic</a></dd>
            <dd><a href="https://alt.fedoraproject.org/en/cloud/">Get Fedora Cloud</a></dd>
            <dd><a href="https://spins.fedoraproject.org">Fedora Spins</a></dd>
            <dd><a href="https://labs.fedoraproject.org">Fedora Labs</a></dd>
            <dd><a href="https://arm.fedoraproject.org">Fedora ARM<span class="sup">&reg;</span></a></dd>
            <dd><a href="https://alt.fedoraproject.org/">Alternative Downloads</a></dd>
          </dl>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">Support</h3>
          <div class="widget-body">
            <dl>
              <dd><a href="https://fedoraproject.org/wiki/Communicating_and_getting_help">Get Help</a></dd>
              <dd><a href="https://ask.fedoraproject.org/">Ask Fedora</a></dd>
              <dd><a href="https://fedoraforum.org/">Forums</a></dd>
              <dd><a href="https://fedoraproject.org/wiki/Common_F25_bugs">Common Bugs</a></dd>
              <dd><a href="https://docs.fedoraproject.org/en-US/Fedora/25/html/Installation_Guide">Installation Guide</a></dd>
            </dl>
          </div>
        </div>
        <div class="col-sm-3 col-xs-6 widget">
          <h3 class="widget-title">Join</h3>
            <div class="widget-body">
            <dl>
              <dd><a href="https://fedoraproject.org/wiki/Join">Join Fedora</a></dd>
              <dd><a href="http://fedoraplanet.org">Planet Fedora</a></dd>
              <dd><a href="https://fedoraproject.org/wiki/SIGs">Fedora SIGs</a></dd>
              <dd><a href="https://admin.fedoraproject.org/accounts/">Fedora Account System</a></dd>
              <dd><a href="https://fedoracommunity.org/">Fedora Community</a></dd>
            </dl>
          </div>
        </div>
      </div> <!-- /row of widgets -->
      <div class="row">
        <div class="col-md-2">
          <div class="widget-body">
            <a href="https://www.redhat.com/"><img alt="Red Hat Logo" src="/static/logo/redhat.png" class="rh-logo"></a>
          </div>
        </div>
        <div class="col-md-7">
          <div class="widget-body">
            <p class="sponsor">Fedora is sponsored by Red Hat.</p>
            <p class="sponsor"><a href="https://www.redhat.com/en/technologies/linux-platforms/articles/relationship-between-fedora-and-rhel">Learn more about the relationship between Red Hat and Fedora »</a></p>
            <p class="copy">&copy; 2021 Red Hat, Inc. and others.</p>
          </div>
        </div>
        <!-- /row of widgets -->
      </div>
</footer>
  </body>
</html>
