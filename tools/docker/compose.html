<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Docker Compose &mdash; Fedora Developer Portal</title>
  <meta name="description" content="Fedora Developer Portal provides information for developers running Fedora on their workstation or virtual machines.
">
  <link rel="canonical" href="https://developer.fedoraproject.org/tools/docker/compose.html">
  <!-- Link to Sitemap -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
  <link href="/css/main.css" rel="stylesheet" media="screen, print">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-69605821-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>
  <body>
        <!-- The top blue thing -->
    <div id="splash" class="splash-size-small splash-section-tools">
      <div class="container">
        <div class="row" id="top">
  <div class="col-sm-2" id="logo-col">
    <div class="text-center">
      <h1>
        <a href="/">
          <img src="/static/logo_white.png" style="height: 46px; width: 152px;">
          <span>Fedora Developer Portal</span>
        </a>
      </h1>
    </div>
  </div>
  <div class="col-sm-7" id="menu-col">
    <nav>
  <ul class="nav navbar-nav">
    <li class="">
      <a href="/start.html">Start a project</a>
    </li>
    <li class=" active ">
      <a href="/tools.html">Get tools</a>
    </li>
    <li class="">
      <a href="/tech.html">Languages &amp; databases</a>
    </li>
    <li class="">
      <a href="/deployment.html">Deploy and distribute</a>
    </li>
    <!--
    <li class="">
      <a href="/">Resources</a>
    </li>
    <li class="">
      <a href="/">Blogs</a>
    </li>
    -->
  </ul>
</nav>
  </div>
  <div class="col-sm-3" id="search-col" style="display: none;">
<!-- // every other page -->
<style media="screen, print">
#search-results {
  position: absolute;
  top: 44px;
  right: 15px;
  z-index: 10;
  width: 288px;
  max-height: 260px;
  overflow-y: scroll;
  padding: 0 10px 0 10px;
  background-color: #fff;
  border: 1px solid transparent;
  border-radius: 4px;
  box-shadow: 0 1px 1px rgba(0,0,0,.05);
}
#search-results a {
  color: #000;
  text-decoration: none;
}
#search-results a:visited {
  color: #000;
}
#search-results article, a {
  width: 100%;
}
#search-results a {
  display: block;
}
#search-results article:hover {
  background-color: #e6e6e6;
}
</style>
  <form class="input-group" id="search" action="/search.html" method="get">
    <input type="text" id="search-query" class="form-control" name="q" placeholder="Search" autocomplete="off">
    <span class="input-group-btn">
      <button class="btn btn-default glyphicon glyphicon-search" type="submit" aria-hidden="true"></button>
    </span>
  </form>
  <section id="search-results" style="display: none;">
    <div class="entries">
    </div>
  </section>
  <script id="search-results-template" type="text/mustache">
    {{#entries}}
      <article>
        <a href="{{url}}">{{title}}</a>
      </article>
    {{/entries}}
  </script>
  </div>
</div>
        <div class="row" id="headlines">
  <div class="col-sm-12">
          <img class="img-rounded" src="/static/logo/docker.png">
          <h2>Docker</h2>
          <p>Platform for distributed applications.</p>
  </div>
</div>
<div class="row" id="attribution">
  <div class="col-sm-12">
    <a href=""></a>
  </div>
</div>
      </div>
    </div>
    <!-- Content -->
    <div class="container">
      <div class="row">
        <div class="col-sm-3">
          <div class="list-group content-menu">
              <a href="/tools/docker/about.html" class="list-group-item ">Docker</a>
              <a href="/tools/docker/docker-interactive-management.html" class="list-group-item ">sen — interactive management</a>
              <a href="/tools/docker/docker-installation.html" class="list-group-item ">Getting started with Docker on Fedora</a>
              <a href="/tools/docker/docker-usage.html" class="list-group-item ">Docker basics</a>
              <a href="/tools/docker/docker-configuration.html" class="list-group-item ">Configuring Docker</a>
              <a href="/tools/docker/docker-images.html" class="list-group-item ">Docker images</a>
              <a href="/tools/docker/compose.html" class="list-group-item  active ">Docker Compose</a>
          </div>
          <div class="panel panel-default">
            <div class="panel-body" style="padding-top:8px;padding-bottom:8px">
              <div id="ask-fedora">
  Have a question?
    <a href="//ask.fedoraproject.org/">Ask Fedora.</a>
</div>
            </div>
          </div>
          <a target="_blank" href="https://github.com/developer-portal/content/edit/master/tools/docker/compose.md" class="btn btn-default">Edit this page</a>
          <a target="_blank" href="https://github.com/developer-portal/content/issues/new?title=tools:+docker+compose.md&body=Describe+the+problem" class="btn btn-default">Report an issue</a>
        </div>
        <div class="col-sm-9">
          <div class="panel panel-default content-content">
            <h1 id="docker-compose">Docker Compose</h1>
<p><a href="https://docs.docker.com/compose/">Docker Compose</a> is a tool to orchestrate one or more containers using a simple YAML file which describes your whole setup.</p>
<p>The Docker community released Docker Compose V2 in 2020 with many changes and new features. With V2, Compose runs as a plug-in to Docker rather than the V1 stand-alone application. For example, <code class="language-plaintext highlighter-rouge">docker compose [opts]</code> instead of the older <code class="language-plaintext highlighter-rouge">docker-compose [opts]</code>. The <a href="https://docs.docker.com/compose/releases/migrate/">Docker Compose V2 Migration Guide</a> is a good reference. The legacy <code class="language-plaintext highlighter-rouge">docker-compose</code> command line is available as an option using <a href="https://github.com/docker/compose-switch">Docker Compose Switch</a>.</p>
<h2 id="installation">Installation</h2>
<p>The package is named <code class="language-plaintext highlighter-rouge">docker-compose</code>, you can install it easily with:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo dnf install docker-compose
</code></pre></div></div>
<h2 id="example-usage">Example usage</h2>
<p>In this example we will go through a simple <a href="https://www.djangoproject.com/">Django</a> &amp; <a href="http://www.postgresql.org/">PostgreSQL</a> development environment setup managed by <code class="language-plaintext highlighter-rouge">docker-compose</code>. We will mount the application sources inside a Docker container, which will allow us to interpret code as we change it. The application container will be linked with the database container so our Django application will be able to communicate with our PostgreSQL database.</p>
<h3 id="prerequisites">Prerequisites</h3>
<h4 id="docker">Docker</h4>
<p>This guide expects that you have Docker engine installed, configured and running (for more information see <a href="/tools/docker/docker-installation.html">the Fedora installation guide</a>).</p>
<h4 id="images">Images</h4>
<p>We will use Fedora-based images from <a href="https://github.com/fedora-cloud/Fedora-Dockerfiles">fedora-dockerfiles</a>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/fedora-cloud/Fedora-Dockerfiles.git
</code></pre></div></div>
<p>Let’s start with Django.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker build --tag=fedora-django Fedora-Dockerfiles/Django
</code></pre></div></div>
<p>And now PostgreSQL (stock one is just fine):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker build --tag=fedora-postgresql Fedora-Dockerfiles/postgresql
</code></pre></div></div>
<h3 id="guide">Guide</h3>
<p>We will name our project <code class="language-plaintext highlighter-rouge">awesome_web</code>. So let’s start by creating a directory for the project (in a directory where you store your projects):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ${MY_PROJECTS}
$ mkdir awesome_web
$ cd awesome_web
</code></pre></div></div>
<p>Whole database will live in subdirectory <code class="language-plaintext highlighter-rouge">db</code> (<code class="language-plaintext highlighter-rouge">postgres</code> user has to own it — docker still lacks user namespaces; <code class="language-plaintext highlighter-rouge">26</code> is UID of <code class="language-plaintext highlighter-rouge">postgres</code> user, see <code class="language-plaintext highlighter-rouge">/usr/share/doc/setup/uidgid</code>):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir db
$ sudo chown 26:26 db
</code></pre></div></div>
<h4 id="docker-compose-configuration"><code class="language-plaintext highlighter-rouge">docker-compose</code> configuration</h4>
<p>First thing to do will be to create a YAML configuration file named <code class="language-plaintext highlighter-rouge">docker-compose.yml</code>. The file should live in the root of our project.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>web:
  image: fedora-django
  ports:
   - "8000:8000"
  volumes:
   - ./awesome_web:/code
  links:
   - db
db:
  image: fedora-postgresql
  volumes:
   - ./db:/var/lib/pgsql/data
  environment:
   - POSTGRESQL_DATABASE=awesome_web
   - POSTGRESQL_USER=awesome_web_user
   - POSTGRESQL_PASSWORD=secret_password
</code></pre></div></div>
<p>Explanation:</p>
<p>Take <code class="language-plaintext highlighter-rouge">fedora-django</code> image and use it for <code class="language-plaintext highlighter-rouge">web</code> container, map port <code class="language-plaintext highlighter-rouge">8000</code> from container to <code class="language-plaintext highlighter-rouge">8000</code> on host, mount directory <code class="language-plaintext highlighter-rouge">awesome_web</code> (that’s where sources will be) to <code class="language-plaintext highlighter-rouge">/code</code> within container and link the <code class="language-plaintext highlighter-rouge">web</code> container to <code class="language-plaintext highlighter-rouge">db</code> container.</p>
<p><code class="language-plaintext highlighter-rouge">db</code> container is even more simple. Mount <code class="language-plaintext highlighter-rouge">db</code> directory inside container so PostgreSQL can populate it. We also need to set some environment variables to create database with username/password access (do not forget to change those!).</p>
<h4 id="create-django-project">Create Django project</h4>
<p>Let’s start new project with command <code class="language-plaintext highlighter-rouge">django-admin</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose run web django-admin startproject awesome_web .
</code></pre></div></div>
<p>Since the container runs as root by default, even our project will be created as root, let’s fix it:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo chown -R $UID:$UID awesome_web
</code></pre></div></div>
<p>Since we use PostgreSQL, we need to change <code class="language-plaintext highlighter-rouge">DATABASES</code> variable in <code class="language-plaintext highlighter-rouge">settings.py</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ $EDITOR awesome_web/awesome_web/settings.py
...
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'awesome_web',
        'USER': 'awesome_web_user',
        'PASSWORD': 'secret_password',
        'HOST': 'db',
        'PORT': 5432,
    }
}
...
</code></pre></div></div>
<h4 id="time-to-populate-database">Time to populate database</h4>
<p>Nowadays this is done by <code class="language-plaintext highlighter-rouge">manage.py migrate</code>. We need to run the database container first, then populate the database:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose up -d db
$ sudo docker-compose run web python3 manage.py migrate
Operations to perform:
  Synchronize unmigrated apps: staticfiles, messages
  Apply all migrations: admin, contenttypes, auth, sessions
Synchronizing apps without migrations:
  Creating tables...
    Running deferred SQL...
  Installing custom SQL...
Running migrations:
  Rendering model states... DONE
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying sessions.0001_initial... OK
</code></pre></div></div>
<p>Is the database really populated?</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker exec -ti awesome_web_db_1 bash
bash-4.3$ psql
psql (9.4.4)
Type "help" for help.


postgres=# \l
                                      List of databases
    Name     |      Owner       | Encoding |  Collate   |   Ctype    |   Access privileges
-------------+------------------+----------+------------+------------+-----------------------
 awesome_web | awesome_web_user | UTF8     | en_US.utf8 | en_US.utf8 |
 postgres    | postgres         | UTF8     | en_US.utf8 | en_US.utf8 |
 template0   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
 template1   | postgres         | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +
             |                  |          |            |            | postgres=CTc/postgres
(4 rows)

postgres=# \connect awesome_web
You are now connected to database "awesome_web" as user "postgres".
awesome_web=# \dt
                       List of relations
 Schema |            Name            | Type  |      Owner
--------+----------------------------+-------+------------------
 public | auth_group                 | table | awesome_web_user
 public | auth_group_permissions     | table | awesome_web_user
 public | auth_permission            | table | awesome_web_user
 public | auth_user                  | table | awesome_web_user
 public | auth_user_groups           | table | awesome_web_user
 public | auth_user_user_permissions | table | awesome_web_user
 public | django_admin_log           | table | awesome_web_user
 public | django_content_type        | table | awesome_web_user
 public | django_migrations          | table | awesome_web_user
 public | django_session             | table | awesome_web_user
(10 rows)
</code></pre></div></div>
<p>This is how your directory layout should look:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── awesome_web
│   ├── awesome_web
│   │   ├── __init__.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   ├── wsgi.py
│   └── manage.py
├── db
│   ├── base
│   ├── global
│   ├── pg_clog
│   ├── pg_dynshmem
│   ├── pg_hba.conf
│   ├── pg_ident.conf
│   ├── pg_log
│   ├── &lt;...and more&gt;
└── docker-compose.yml
</code></pre></div></div>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>It may happen to you that something does not work and you will end up with error message like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting awesomeweb_db_1...
Cannot start container bg1f8cb2d227a6efa5e82d9669235430f63dadc76a5ddd4907248f1edc11490a:
    Cannot link to a non running container: /awesomeweb_db_1 AS /awesomeweb_web_run_2/awesomeweb_db_1
</code></pre></div></div>
<p>Best way to figure out what went wrong is to check logs:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose logs
</code></pre></div></div>
<p>In thiscase , the <code class="language-plaintext highlighter-rouge">db</code> service was not running, so we can check logs of it exclusively:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose logs db
</code></pre></div></div>
<h3 id="time-to-spin-the-whole-environment">Time to spin the whole environment!</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo docker-compose up
</code></pre></div></div>
<p>That’s it! You have your development environment running in docker containers! You can check easily:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ elinks -dump http://$(docker inspect -f '{{ .NetworkSettings.IPAddress }}' awesomeweb_web_1):8000
</code></pre></div></div>
<hr id="authors-rule" />
<p style="text-align: center">Authors: <a href="mailto:%61%73%61%6D%61%6C%69%6B@%72%65%64%68%61%74.%63%6F%6D">Adam Samalik</a>, <a href="mailto:%62%72%61%64%6C%65%79.%67.%73%6D%69%74%68@%67%6D%61%69%6C.%63%6F%6D">Brad Smith</a>, <a href="mailto:%76%6F%6E%62%72%61%6E%64@%69%6E%66.%75%74%66%73%6D.%63%6C">Horst H. von Brand</a>, <a href="mailto:%6A%70%72%6F%6B%6F%70@%72%65%64%68%61%74.%63%6F%6D">Jarek Prokop</a>, <a href="mailto:%64%69%72%73%63%68%6E@%67%6D%61%69%6C.%63%6F%6D">Nick Dirschel</a></p>
          </div>
        </div>
      </div>
    </div>
    <!-- Some other stuff -->
    <div class=" banner-contribute">
  <div class="container">
    <h2> Share your knowledge </h2>
    <p> Fedora Developer Portal is a community effort to share guides and information about open-source development. And we need your help! </p>
    <a href="http://developer-portal.github.io/contributing/" class="btn btn-primary">Learn how to contribute</a>
  </div>
</div>
    <footer class="footer">
  <div class="container">
    <div class="row footerlinks">
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">About</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="/about.html">About Developer Portal</a></dd>
            <dd><a href="https://docs.fedoraproject.org/en-US/project/">About Fedora</a></dd>
            <dd><a href="https://getfedora.org/en/sponsors">Sponsors</a></dd>
            <dd><a href="https://fedoramagazine.org">Fedora Magazine</a></dd>
            <dd><a href="https://fedoraproject.org/wiki/Legal:Main#Legal">Legal</a></dd>
          </dl>
          <ul class="list-inline">
            <li>
              <a class="btn-social btn-outline" href="https://www.facebook.com/TheFedoraProject"><i class="fa fa-fw fa-facebook"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="https://plus.google.com/112917221531140868607"><i class="fa fa-fw fa-google-plus"></i></a>
            </li>
            <li>
              <a class="btn-social btn-outline" href="https://twitter.com/fedora"><i class="fa fa-fw fa-twitter"></i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title uppercase">Download</h3>
        <div class="widget-body">
          <dl>
            <dd><a href="https://getfedora.org/en/workstation/download/">Get Fedora Workstation</a></dd>
            <dd><a href="https://getfedora.org/en/server/download/">Get Fedora Server</a></dd>
            <dd><a href="https://getfedora.org/en/atomic/download/">Get Fedora Atomic</a></dd>
            <dd><a href="https://alt.fedoraproject.org/en/cloud/">Get Fedora Cloud</a></dd>
            <dd><a href="https://spins.fedoraproject.org">Fedora Spins</a></dd>
            <dd><a href="https://labs.fedoraproject.org">Fedora Labs</a></dd>
            <dd><a href="https://arm.fedoraproject.org">Fedora ARM<span class="sup">&reg;</span></a></dd>
            <dd><a href="https://alt.fedoraproject.org/">Alternative Downloads</a></dd>
          </dl>
        </div>
      </div>
      <div class="col-sm-3 col-xs-6 widget">
        <h3 class="widget-title">Support</h3>
          <div class="widget-body">
            <dl>
              <dd><a href="https://fedoraproject.org/wiki/Communicating_and_getting_help">Get Help</a></dd>
              <dd><a href="https://ask.fedoraproject.org/">Ask Fedora</a></dd>
              <dd><a href="https://fedoraforum.org/">Forums</a></dd>
              <dd><a href="https://fedoraproject.org/wiki/Common_F39_bugs">Common Bugs</a></dd>
              <dd><a href="https://docs.fedoraproject.org/en-US/fedora/f39/install-guide/">Installation Guide</a></dd>
            </dl>
          </div>
        </div>
        <div class="col-sm-3 col-xs-6 widget">
          <h3 class="widget-title">Join</h3>
            <div class="widget-body">
            <dl>
              <dd><a href="https://fedoraproject.org/wiki/Join">Join Fedora</a></dd>
              <dd><a href="http://fedoraplanet.org">Planet Fedora</a></dd>
              <dd><a href="https://fedoraproject.org/wiki/SIGs">Fedora SIGs</a></dd>
              <dd><a href="https://admin.fedoraproject.org/accounts/">Fedora Account System</a></dd>
              <dd><a href="https://fedoracommunity.org/">Fedora Community</a></dd>
            </dl>
          </div>
        </div>
      </div> <!-- /row of widgets -->
      <div class="row">
        <div class="col-md-2">
          <div class="widget-body">
            <a href="https://www.redhat.com/"><img alt="Red Hat Logo" src="/static/logo/redhat.png" class="rh-logo"></a>
          </div>
        </div>
        <div class="col-md-7">
          <div class="widget-body">
            <p class="sponsor">Fedora is sponsored by Red Hat.</p>
            <p class="sponsor"><a href="https://www.redhat.com/en/technologies/linux-platforms/articles/relationship-between-fedora-and-rhel">Learn more about the relationship between Red Hat and Fedora »</a></p>
            <p class="copy">&copy; 2024 Red Hat, Inc. and others.</p>
          </div>
        </div>
        <!-- /row of widgets -->
      </div>
</footer>
  </body>
</html>
